{"version":3,"sources":["../../ts-scripts/SampleManager.ts","../../ts-scripts/ScriptBox.ts","../../ts-scripts/main.ts"],"sourcesContent":["import { world, system, DimensionLocation, ScriptEventCommandMessageAfterEvent } from \"@minecraft/server\";\r\n\r\nexport default class SampleManager {\r\n  tickCount = 0;\r\n\r\n  _availableFuncs: {\r\n    [name: string]: Array<(log: (message: string, status?: number) => void, location: DimensionLocation) => void>;\r\n  };\r\n\r\n  pendingFuncs: Array<{\r\n    name: string;\r\n    func: (log: (message: string, status?: number) => void, location: DimensionLocation) => void;\r\n    location: DimensionLocation;\r\n  }> = [];\r\n\r\n  gamePlayLogger(message: string, status?: number) {\r\n    if (status !== undefined && status > 0) {\r\n      message = \"SUCCESS: \" + message;\r\n    } else if (status !== undefined && status < 0) {\r\n      message = \"FAIL: \" + message;\r\n    }\r\n\r\n    world.sendMessage(message);\r\n    console.warn(message);\r\n  }\r\n\r\n  newScriptEvent(scriptEvent: ScriptEventCommandMessageAfterEvent) {\r\n    const messageId = scriptEvent.id.toLowerCase();\r\n\r\n    if (messageId.startsWith(\"sample\") && scriptEvent.sourceEntity) {\r\n      const nearbyBlock = scriptEvent.sourceEntity.getBlockFromViewDirection();\r\n      if (!nearbyBlock) {\r\n        this.gamePlayLogger(\"Please look at the block where you want me to run this.\");\r\n        return;\r\n      }\r\n\r\n      const nearbyBlockLoc = nearbyBlock.block.location;\r\n      const nearbyLoc = { x: nearbyBlockLoc.x, y: nearbyBlockLoc.y + 1, z: nearbyBlockLoc.z };\r\n\r\n      if (messageId === \"sample:run\") {\r\n        for (const sampleFuncKey in this._availableFuncs) {\r\n          const sampleFunc = this._availableFuncs[sampleFuncKey];\r\n\r\n          this.runSample(sampleFuncKey + this.tickCount, sampleFunc, {\r\n            ...nearbyLoc,\r\n            dimension: scriptEvent.sourceEntity.dimension,\r\n          });\r\n\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  runSample(\r\n    sampleId: string,\r\n    snippetFunctions: Array<(log: (message: string, status?: number) => void, location: DimensionLocation) => void>,\r\n    targetLocation: DimensionLocation\r\n  ) {\r\n    for (let i = snippetFunctions.length - 1; i >= 0; i--) {\r\n      this.pendingFuncs.push({ name: sampleId, func: snippetFunctions[i], location: targetLocation });\r\n    }\r\n  }\r\n\r\n  worldTick() {\r\n    if (this.tickCount % 10 === 0) {\r\n      if (this.pendingFuncs.length > 0) {\r\n        const funcSet = this.pendingFuncs.pop();\r\n\r\n        if (funcSet) {\r\n          try {\r\n            funcSet.func(this.gamePlayLogger, funcSet.location);\r\n          } catch (e: any) {\r\n            world.sendMessage(\"Could not run sample function. Error: \" + e.toString());\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (this.tickCount === 200) {\r\n      world.sendMessage(\"Type '/scriptevent sample:run' in chat to run this sample.\");\r\n    }\r\n\r\n    this.tickCount++;\r\n\r\n    system.run(this.worldTick);\r\n  }\r\n\r\n  constructor() {\r\n    this._availableFuncs = {};\r\n\r\n    this.gamePlayLogger = this.gamePlayLogger.bind(this);\r\n\r\n    this.worldTick = this.worldTick.bind(this);\r\n\r\n    system.afterEvents.scriptEventReceive.subscribe(this.newScriptEvent.bind(this));\r\n\r\n    system.run(this.worldTick);\r\n  }\r\n\r\n  registerSamples(sampleSet: {\r\n    [name: string]: Array<(log: (message: string, status?: number) => void, location: DimensionLocation) => void>;\r\n  }) {\r\n    for (const sampleKey in sampleSet) {\r\n      if (sampleKey.length > 1 && sampleSet[sampleKey]) {\r\n        this._availableFuncs[sampleKey] = sampleSet[sampleKey];\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { world, DimensionLocation } from \"@minecraft/server\";\r\n\r\n// When running a world with this behavior pack, type '/scriptevent sample:run' in chat to trigger this code.\r\nexport function scriptBox(log: (message: string, status?: number) => void, targetLocation: DimensionLocation) {\r\n  world.sendMessage(\"Hello world! Replace this line with your code.\");\r\n}\r\n","import SampleManager from \"./SampleManager\";\r\nimport { scriptBox } from \"./ScriptBox\";\r\n\r\nconst sm = new SampleManager();\r\n\r\nsm.registerSamples({\r\n  scriptBox: [scriptBox],\r\n});\r\n"],"mappings":";AAAA,SAAS,OAAO,cAAsE;AAEtF,IAAqB,gBAArB,MAAmC;AAAA,EACjC,YAAY;AAAA,EAEZ;AAAA,EAIA,eAIK,CAAC;AAAA,EAEN,eAAe,SAAiB,QAAiB;AAC/C,QAAI,WAAW,UAAa,SAAS,GAAG;AACtC,gBAAU,cAAc;AAAA,IAC1B,WAAW,WAAW,UAAa,SAAS,GAAG;AAC7C,gBAAU,WAAW;AAAA,IACvB;AAEA,UAAM,YAAY,OAAO;AACzB,YAAQ,KAAK,OAAO;AAAA,EACtB;AAAA,EAEA,eAAe,aAAkD;AAC/D,UAAM,YAAY,YAAY,GAAG,YAAY;AAE7C,QAAI,UAAU,WAAW,QAAQ,KAAK,YAAY,cAAc;AAC9D,YAAM,cAAc,YAAY,aAAa,0BAA0B;AACvE,UAAI,CAAC,aAAa;AAChB,aAAK,eAAe,yDAAyD;AAC7E;AAAA,MACF;AAEA,YAAM,iBAAiB,YAAY,MAAM;AACzC,YAAM,YAAY,EAAE,GAAG,eAAe,GAAG,GAAG,eAAe,IAAI,GAAG,GAAG,eAAe,EAAE;AAEtF,UAAI,cAAc,cAAc;AAC9B,mBAAW,iBAAiB,KAAK,iBAAiB;AAChD,gBAAM,aAAa,KAAK,gBAAgB,aAAa;AAErD,eAAK,UAAU,gBAAgB,KAAK,WAAW,YAAY;AAAA,YACzD,GAAG;AAAA,YACH,WAAW,YAAY,aAAa;AAAA,UACtC,CAAC;AAED;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,UACE,UACA,kBACA,gBACA;AACA,aAAS,IAAI,iBAAiB,SAAS,GAAG,KAAK,GAAG,KAAK;AACrD,WAAK,aAAa,KAAK,EAAE,MAAM,UAAU,MAAM,iBAAiB,CAAC,GAAG,UAAU,eAAe,CAAC;AAAA,IAChG;AAAA,EACF;AAAA,EAEA,YAAY;AACV,QAAI,KAAK,YAAY,OAAO,GAAG;AAC7B,UAAI,KAAK,aAAa,SAAS,GAAG;AAChC,cAAM,UAAU,KAAK,aAAa,IAAI;AAEtC,YAAI,SAAS;AACX,cAAI;AACF,oBAAQ,KAAK,KAAK,gBAAgB,QAAQ,QAAQ;AAAA,UACpD,SAAS,GAAQ;AACf,kBAAM,YAAY,2CAA2C,EAAE,SAAS,CAAC;AAAA,UAC3E;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,QAAI,KAAK,cAAc,KAAK;AAC1B,YAAM,YAAY,4DAA4D;AAAA,IAChF;AAEA,SAAK;AAEL,WAAO,IAAI,KAAK,SAAS;AAAA,EAC3B;AAAA,EAEA,cAAc;AACZ,SAAK,kBAAkB,CAAC;AAExB,SAAK,iBAAiB,KAAK,eAAe,KAAK,IAAI;AAEnD,SAAK,YAAY,KAAK,UAAU,KAAK,IAAI;AAEzC,WAAO,YAAY,mBAAmB,UAAU,KAAK,eAAe,KAAK,IAAI,CAAC;AAE9E,WAAO,IAAI,KAAK,SAAS;AAAA,EAC3B;AAAA,EAEA,gBAAgB,WAEb;AACD,eAAW,aAAa,WAAW;AACjC,UAAI,UAAU,SAAS,KAAK,UAAU,SAAS,GAAG;AAChD,aAAK,gBAAgB,SAAS,IAAI,UAAU,SAAS;AAAA,MACvD;AAAA,IACF;AAAA,EACF;AACF;;;AC5GA,SAAS,SAAAA,cAAgC;AAGlC,SAAS,UAAU,KAAiD,gBAAmC;AAC5G,EAAAA,OAAM,YAAY,gDAAgD;AACpE;;;ACFA,IAAM,KAAK,IAAI,cAAc;AAE7B,GAAG,gBAAgB;AAAA,EACjB,WAAW,CAAC,SAAS;AACvB,CAAC;","names":["world"],"file":"../../Regolith/packs/BP/scripts/main.js"}